<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Product Listing Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body>
    <div class="container p-2">
        <h1>Product Listing Page</h1>
        <div class="row">
            <div class="col-12 col-md-6">
                <form>
                    <div class="form-group">
                        <label>Choose price range</label>
                        <input type="number" class="form-control low_price" id="Enter-ProductType" placeholder="Enter Low Price (default: 0)">
                        <input type="number" class="form-control high_price" id="Enter-ProductType" placeholder="Enter High Price (default: 2147483647)">
                    </div>
                </form>
            </div>
            <div class="col-12 col-md-6">
                <label>Choose product type</label>
                <select class="form-select" aria-label="Default select example">
                    <option selected>Open this select menu</option>
                </select>
            </div>
        </div>
        <button class="search_btn m-2">Search</button>
        <div class="col-12 search_list d-flex flex-wrap"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

    <script type="module">
        import { product } from "./product.js";
        let arr, container, btn_search, search_list;
        btn_search = document.querySelector(".search_btn");
        container = document.querySelector(".container");

        window.onload = function () {
            Create_Search_List();
        }
        btn_search.addEventListener("click", Search_Result_List);

        function Search_Result_List() {
            search_list = document.querySelector(".search_list");
            search_list.innerText = "";
            let search_condition_ProductType = document.querySelector("select").value;
            let search_condition_low_price = document.querySelector(".low_price").value;
            let search_condition_high_price = document.querySelector(".high_price").value;
            if (search_condition_low_price == "" || search_condition_low_price < 0){
                search_condition_low_price = 0;
                document.querySelector(".low_price").value = "0";
            }
            if (search_condition_high_price == ""){
                search_condition_high_price = 2147483647;
                document.querySelector(".high_price").value = "2147483647";
            }
            if (search_condition_high_price < search_condition_low_price){
                let temp = search_condition_high_price;
                search_condition_high_price = search_condition_low_price;
                document.querySelector(".high_price").value = search_condition_low_price;
                search_condition_low_price = temp;
                document.querySelector(".low_price").value = search_condition_low_price;
            }
            arr = [];
            if (search_condition_ProductType == "All"){
                arr = product.filter((_element) => {
                return _element.Price >= search_condition_low_price && _element.Price <= search_condition_high_price;
            });
            }
            else{
                arr = product.filter((_element) => {
                return _element.Price >= search_condition_low_price && _element.Price <= search_condition_high_price && _element.ProductType == search_condition_ProductType;
            });
            }
            
            if (arr.length > 0) {
                arr.forEach(element => {
                    let div = document.createElement("div");
                    let p;
                    div.setAttribute('class','col-12 col-md-3 p-2');
                    div.setAttribute('style','background-color: black; border: 1px solid white; color: white;');
                    Object.entries(element).forEach(_element => {
                        p = document.createElement("p");
                        if (_element[0] == "Amount" && _element[1] == 0){
                            p.setAttribute('style','color: red;');
                            p.innerText = `${_element[0]}: ${_element[1]}`;
                        }else{
                            p.innerText = `${_element[0]}: ${_element[1]}`;
                        }
                        div.append(p);
                    });
                    
                    search_list.append(div);
                });
                container.append(search_list);
            }
            else if (arr.length == 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'No match product!',
                })
            }
        }

        function Create_Search_List() {
            let select = document.querySelector("select");
            select.innerText = "";
            arr = product.filter((_element) => {
                return _element;
            });
            let arr_element = [];
            arr.forEach(element => {
                arr_element.push(element.ProductType);
            });
            let uniq = [...new Set(arr_element)];
            let opt = document.createElement("option");
            opt.innerHTML = `<option value="all">All</option>`;
            select.append(opt);
            uniq.forEach(element => {
                opt = document.createElement("option");
                opt.innerHTML = `<option value="${element}">${element}</option>`;
                select.append(opt);
            });
        }
    </script>
</body>

</html>